<% layout('layouts/boilerplate')%>
<link rel="stylesheet" href="/stylesheets/stars.css" />
<link rel="stylesheet" href="/stylesheets/font.css" />
<div class="container mb-5">
  <div class="row mt-5">
    <div class="col-8">
      <div id="HamiltonCarousel" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <% house.images.forEach((img, i)=> { %>
          <div class="carousel-item <%= i === 0 ? 'active' : ''%>">
            <img src="<%= img.url%>" class="d-block w-100" alt="" />
          </div>
          <% }) %>
        </div>
        <% if(house.images.length > 1) {%>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#HamiltonCarousel"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#HamiltonCarousel"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
          <% } %>
        </button>
      </div>
      <div class="card mb-3">
        <div class="card-body">
          <div class="card-body">
            <h1 class="card-title"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-bricks" viewBox="0 0 16 16">
                <path d="M0 .5A.5.5 0 0 1 .5 0h15a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H.5a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5H2v-2H.5a.5.5 0 0 1-.5-.5v-3A.5.5 0 0 1 .5 6H2V4H.5a.5.5 0 0 1-.5-.5v-3zM3 4v2h4.5V4H3zm5.5 0v2H13V4H8.5zM3 10v2h4.5v-2H3zm5.5 0v2H13v-2H8.5zM1 1v2h3.5V1H1zm4.5 0v2h5V1h-5zm6 0v2H15V1h-3.5zM1 7v2h3.5V7H1zm4.5 0v2h5V7h-5zm6 0v2H15V7h-3.5zM1 13v2h3.5v-2H1zm4.5 0v2h5v-2h-5zm6 0v2H15v-2h-3.5z"/>
              </svg>  <%= house.title%></h1>
            <p class="card-text"><%= house.description%></p>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" fill="currentColor" class="bi bi-joystick" viewBox="0 0 16 16">
                <path d="M10 2a2 2 0 0 1-1.5 1.937v5.087c.863.083 1.5.377 1.5.726 0 .414-.895.75-2 .75s-2-.336-2-.75c0-.35.637-.643 1.5-.726V3.937A2 2 0 1 1 10 2z"/>
                <path d="M0 9.665v1.717a1 1 0 0 0 .553.894l6.553 3.277a2 2 0 0 0 1.788 0l6.553-3.277a1 1 0 0 0 .553-.894V9.665c0-.1-.06-.19-.152-.23L9.5 6.715v.993l5.227 2.178a.125.125 0 0 1 .001.23l-5.94 2.546a2 2 0 0 1-1.576 0l-5.94-2.546a.125.125 0 0 1 .001-.23L6.5 7.708l-.013-.988L.152 9.435a.25.25 0 0 0-.152.23z"/>
              </svg>  <%= house.location%></li>
            <li class="list-group-item"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" fill="currentColor" class="bi bi-cash-coin" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0z"/>
                <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1h-.003zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195l.054.012z"/>
                <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083c.058-.344.145-.678.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1H1z"/>
                <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 5.982 5.982 0 0 1 3.13-1.567z"/>
              </svg>  <%= house.price%> /month</li>
          </ul>
          <% if( currentUser && house.author.equals(currentUser._id)) {%>
          <div class="card-body">
            <a class="card-link btn btn-info" href="/houses/<%=house._id%>/edit"
              >Edit</a
            >
            <form
              class="d-inline"
              action="/houses/<%=house._id%>?_method=DELETE"
              method="POST"
            >
              <button class="btn btn-danger">Delete</button>
            </form>
          </div>
          <% } %>
          <div class="card-footer text-muted">2 days ago</div>
        </div>
      </div>

      <div class="card" style="width: 20rem;">
        <div class="card-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
              </svg>  Contact householder here:
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"> Name: <%= house.author.username%></li>
          <li class="list-group-item"> Email: <%= house.author.email%></li>
        </ul>
      </div>

    </div>

    <div class="col-4">
      <!-- Location -->
      <div id="map" style="width: 100%; height: 300px"></div>
      <!-- Comment card -->
      <div class="card mt-3">
        <% if(currentUser){ %>
        <section class="bg-light">
          <div class="card bg-light">
            <div class="card-body">
              <!-- <h5>Leave your comment here ...</h5> -->
              <form
                action="/houses/<%=house._id%>/reviews"
                method="POST"
                class="mb-3 validated-form"
                novalidate
              >
                <h5>How much would you rate this house?</h5>
                <fieldset class="starability-basic">
                  <input
                    type="radio"
                    id="no-rate"
                    class="input-no-rate"
                    name="review[rating]"
                    value="1"
                    checked
                    aria-label="No rating."
                  />
                  <input
                    type="radio"
                    id="first-rate1"
                    name="review[rating]"
                    value="1"
                  />
                  <label for="first-rate1" title="Terrible">1 star</label>
                  <input
                    type="radio"
                    id="first-rate2"
                    name="review[rating]"
                    value="2"
                  />
                  <label for="first-rate2" title="Not good">2 stars</label>
                  <input
                    type="radio"
                    id="first-rate3"
                    name="review[rating]"
                    value="3"
                  />
                  <label for="first-rate3" title="Average">3 stars</label>
                  <input
                    type="radio"
                    id="first-rate4"
                    name="review[rating]"
                    value="4"
                  />
                  <label for="first-rate4" title="Very good">4 stars</label>
                  <input
                    type="radio"
                    id="first-rate5"
                    name="review[rating]"
                    value="5"
                  />
                  <label for="first-rate5" title="Amazing">5 stars</label>
                </fieldset>
                <div class="mb-3">
                  <h5>Leave your review here:</h5>
                  <label class="form-label" for="body"></label>
                  <textarea
                    class="form-control"
                    name="review[body]"
                    id="body"
                    cols="30"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <button class="btn btn-success">Submit</button>
              </form>
              <% } else{%>
              <div class="alert alert-primary" role="alert">
                If you also want to leave a review, please
                <a href="/login" class="alert-link">log in</a> here :)
              </div>
              <% } %> <% for(let review of house.reviews) { %>
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Rating: <%= review.rating %></h5>
                  <p
                    class="starability-result"
                    data-rating="<%=review.rating%>"
                  >
                    Rated: <%= review.rating %> stars
                  </p>
                  <h6 class="card-subtitle mb-2 text-muted">
                    By <%= review.author.username%>
                  </h6>
                  <p class="card-text">Review: <%= review.body %></p>
                  <% if( currentUser && review.author.equals(currentUser._id))
                  {%>
                  <form
                    action="/houses/<%=house._id%>/reviews/<%=review._id%>?_method=DELETE"
                    method="POST"
                  >
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </form>
                  <% } %>
                </div>
              </div>
              <% } %>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
<script>
  const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
  const house = <%-JSON.stringify(house) %>;
</script>
<script src="/javascripts/showPageMap.js"></script>
